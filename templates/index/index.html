{% extends 'layout.html' %}

{% block body %}

<div class="container-fluid" id="padding0">

	<div class = "banner-inicial row">
			<div class="col-sm-4">
			</div>
			<div class="col-sm-8 col-centralizada">
				<div class="caixa-transparente color-black">
					<h1 style="margin-bottom: 20px;">Bem vindo ao Toilet View</h1>
					<p style="font-size: 20px;">O Toilet View é uma solução tecnológica para monitoramento de banheiros públicos e corporativos. Utilizando sensores de presença e qualidade do ar, o sistema informa em tempo real a ocupação das cabines e a necessidade de limpeza, garantindo mais conforto, eficiência e higiene para os usuários.</p>
  				</div>
			</div>
	</div>


<div class="secao1-sobre-projeto">
  <div class="container d-flex justify-content-between align-items-center flex-wrap">

    <!-- Coluna esquerda: logotipo -->
    <div class="coluna-logo">
      <img src="{{ url_for('static', filename='img/bacon.png') }}" alt="Logo Toilet View" class="logo-projeto">
      <p class="subtexto-logo">
        O projeto foi idealizado para ambientes com alto fluxo de pessoas, como universidades, shoppings, aeroportos e empresas.
      </p>
    </div>

    <!-- Coluna direita: texto -->
    <div class="coluna-texto-projeto">
      <h2>Por que criamos o Toilet View?</h2>
      <p>
        Banheiros de uso coletivo geralmente sofrem com filas, falta de manutenção e incerteza sobre sua condição de uso.
        Pensando nisso, desenvolvemos um sistema inteligente que torna possível visualizar quais cabines estão livres
        e quando a limpeza é necessária — tudo por meio de sensores discretos e eficientes.
      </p>
      <p>
        Ele é fácil de integrar, oferece visualizações intuitivas e ajuda na otimização da equipe de limpeza.
      </p>
    </div>

  </div>
</div>


<div class="secao2-sensores">
  <div class="container sensores-grid">

    <!-- Sensor de Ocupação -->
    <div class="sensor-item">
      <h3>Sensor de Ocupação (VS340-915M)</h3>
      <div class="imagem-circular">
        <img src="{{ url_for('static', filename='img/sensor-presenca.jpg') }}" alt="Sensor de Ocupação">
      </div>
      <p class="sensor-desc">
        Este sensor é instalado dentro das cabines para detectar presença com precisão.
        Seu funcionamento é baseado em detecção por movimento e presença, o que permite
        informar em tempo real se a cabine está ocupada ou livre.
      </p>
    </div>

    <!-- Sensor de Odor -->
    <div class="sensor-item">
      <h3>Sensor de Odor (GS301-915M)</h3>
      <div class="imagem-circular">
        <img src="{{ url_for('static', filename='img/sensor-odor.jpg') }}" alt="Sensor de Odor">
      </div>
      <p class="sensor-desc">
        Responsável por monitorar a qualidade do ar, este sensor detecta gases e compostos
        orgânicos voláteis (VOCs). Quando os níveis ultrapassam um limite pré-definido,
        o sistema sugere a necessidade de limpeza no ambiente.
      </p>
    </div>

	  </div>
</div>

	<div class="secao3">
		<h1>Sensores</h1>
	</div>

	<div class="row">
		<div class="col-sm-4">

			<div class="card shadow my-4">
				<div class="card-body">
					<form id="form">
						<div class="form-group">
							<label for="data">Data</label>
							<input id="data" name="data" class="form-control" type="date" value="{{ hoje }}" />
						</div>

						<button type="submit" class="btn btn-primary">Listar</button>
					</form>
				</div>
			</div>

		</div>
	</div>

	<div class="card shadow my-4">
		<div class="card-body" id="div-grafico"></div>
	</div>

</div>

<script src="/static/js/jquery-validate/jquery.validate.min.js"></script>
<script src="/static/js/jquery-validate/additional-methods.min.js"></script>
<script src="/static/js/jquery-validate/localization/messages_pt_BR.min.js"></script>
<script type="text/javascript" src="/static/js/chart.js/chart.min.js"></script>

<script type="text/javascript">
	"use strict";

	$("#form").validate({
		rules: {
			data: {
				required: true
			}
		},
		submitHandler: function () {
			atualizarDados();
		}
	});

	async function atualizarDados() {
		waitSwal();

		try {

			let response = await fetch("/obterDados");

			if (response.ok) {

				Swal.close();

				let div = document.getElementById("div-grafico");
				div.innerHTML = '<canvas id="grafico-barras" style="height: 50vh;"></canvas>';

				let labels = [], data = [];

				let dados = await response.json();
				if (!dados || !dados.length) {
					Swal.fire("Erro", "Sem dados na data especificada!", "error");
					return;
				}

				for (let i = 0; i < dados.length; i++) {
					labels.push(dados[i].dia);
					data.push(dados[i].valor);
				}

				let grafico = new Chart(document.getElementById("grafico-barras"), {
					type: "bar",
					data: {
						labels: labels,
						datasets: [{
							label: "Valor",
							backgroundColor: "#4e73df",
							hoverBackgroundColor: "#2e59d9",
							borderColor: "#4e73df",
							data: data,
						}],
					},
					options: {
						maintainAspectRatio: false,
						layout: {
							padding: {
								left: 10,
								right: 25,
								top: 25,
								bottom: 0
							}
						},
						scales: {
							x: {
								gridLines: {
									display: false,
									drawBorder: false
								},
								ticks: {
									maxTicksLimit: 10
								},
								maxBarThickness: 25,
							},
							y: {
								//display: false,
								ticks: {
									min: 0,
									max: 10,
									maxTicksLimit: 10,
									padding: 10
								},
								gridLines: {
									color: "rgb(234, 236, 244)",
									zeroLineColor: "rgb(234, 236, 244)",
									drawBorder: false,
									borderDash: [2],
									zeroLineBorderDash: [2]
								}
							},
						},
						legend: {
							display: false
						},
						tooltips: {
							titleMarginBottom: 10,
							titleFontColor: '#6e707e',
							titleFontSize: 14,
							backgroundColor: "rgb(255,255,255)",
							bodyFontColor: "#858796",
							borderColor: '#dddfeb',
							borderWidth: 1,
							xPadding: 15,
							yPadding: 15,
							displayColors: false,
							caretPadding: 10
						},
					}
				});

			} else {
				await exibirErro(response);
			}

		} catch (ex) {
			Swal.fire("Erro", "Erro ao listar os dados: " + ex.message, "error");
		}
	}

	atualizarDados();

</script>

{% endblock %}
